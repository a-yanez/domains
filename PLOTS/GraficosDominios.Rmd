```{r}
library(readr)
library(ggplot2)
library(plyr)
library( reshape )

```
1. Hacer FastOrtho de MIBiG
Hecho. El resultado está en FASTORTHO/MiBIG.fastortho incluyendo PKS y NRPS. 
<!--NumGenes vs Familias-->  

2. Hacer Pfam de MIBiG
Hecho, el archivo MIBIG-Pfam.out contiene el resultado de aplicar PfamScan sobre las secuencias de aminoácidos MIBiG. El archivo  MIBIG-Pfam.out.mod está modificado cambiando espacios por tabuladores para facilitar su manipulación.  

3. Seleccionar las primeras n familias no PKS o NRPS (grep | cut -d ..etc)  
<!--
grep -o NRPS |grep -o pKS ????
Se buscó tanto acrónimo como completo non ribosomal, NRP etc
-->
Después se realizó un filtrado que se guardó en SELECTION.fastortho elimininando NRPS PKS según su anotación en MIBiG. Finalmente el archivo ABUNDANT10.fastortho contiene las 10 familias más abundantes que NO son PKS ni NRPS.   

Para cada familia queremos realizar un boxplot incluyendo datos de # dominios pfam  
Para ello necesit amos una tabla tipo (Estamos aqui)  
Gen1_1	#dominio  
Gen1_2	#dominio  

<!--OBJETIVO 1 Familia vs número de dominios-->
Donde el primer 1 corresponde a la familia y el segundo digito al numero de gen esa familia  
```{r tablas}
FIRSTmission <- read_delim("../OUTPUTS/FIRSTmission", "\t", escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
head(FIRSTmission)
```

Esta tabla tabla la cambiamos para poderla graficar, donde cada renglón es un registro de un gen, la primera columna dice a qué familia pertenece y la segunda columna cuántos dominios tiene.   

```{r tabla2}
FIRSTmission_MOD2 <- read_delim("FIRSTmission_MOD2.csv", "\t", escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
head(FIRSTmission_MOD2)
#Familia1 numDominios
#Cada rebglón es una ocurrencia de un gen de la familia 1

```

Ahora sí graficaremos el boxplot de esta tabla en R  
<!--- PENDIENTES
1 LA FUNCION POR GEN
2 EL NUMERO DE GENES POR FAMILIA 
-->
  <!--- mision 1 -->
```{r NumDominiosPorFamilia}
colnames(FIRSTmission_MOD2)=c("family","domains_number")
bymedian <- with(FIRSTmission_MOD2, reorder(family, domains_number, median))
#taplply<-FIRSTmission_MOD2(,family)

tapply(FIRSTmission_MOD2$family, FIRSTmission_MOD2$domains_number, median)
#levels=levels(FIRSTmission_MOD2$Order)[bymedian]
#p<-ggplot(FIRSTmission_MOD2,aes(x=family,y=domains_number,group=family))+geom_boxplot()
p<-ggplot(bymedian,aes(x=family,y=domains_number,group=family))+geom_boxplot()
p

## Falta sort families
```
<!--- FIN OBJETIVO 1-->


<!--- OBJETIVO 2 Dominio vs NumFamilias
cotntar ocurrencia unicas dominio, familia -->
5. También sería interesante qué dominios son (Luego se puede graficar por dominio  )
Eje x dominio 1, dominio 2 ...
Eje y 


```{r dominios}
countDOMAINS <- read_delim("../OUTPUTS/countDOMAINS", "\t", escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
head(countDOMAINS)
# NumeroFamilia  Nombbre del dominio  #cuantas Veces aparece el dominio por familia
# Queremos normalizar y por eso necesitamos el numero de genes por familia
# Medida de ocurrencia de dominios por familia (#dominios)/(#genes en la familia)
```

Dominio1	#Veces en Familia1   
Dominio1	#Veces en Familia 2   
….  
Dominio1	#VecesTotales  
Dominio2	#VecesFamilia1   
<!-- Fin objetivo 2-->


<!-- Objetivo 3-->
<!--Incidencia de Familias por Dominios-->
```{r}
TableDomain <- read_delim("../OUTPUTS/THIRDmission.csv", "\t", escape_double = FALSE, trim_ws = TRUE)

HeadTable<-head(TableDomain,10)
HeadTable
HeadTable[5,1]<-"fam2"
HeadTable[6,1]<-"fam2"
HeadTable[5,"MembersFamily"]<-"50"
HeadTable[6,"MembersFamily"]<-"50"
HeadTable$Percentage<-HeadTable$MembersFamily

HeadTable
#HeadTable.m<-melt(HeadTable)
#TailTable
#ShortTable<-join(HeadTable,TailTable,by.x = "DomainName",by.y = "DomainName")
#ShortTable
DomTable<-count(HeadTable,c("Family","DomainName"))
Genes=count(HeadTable,c("Family"))

## Funcion que regrese para cada familia y dominio su frecuencia 
FrecuenciaDominioFamilia<-function(x){
  #x is a row x[1]=Family x[2]=DomainName
  familia<-x[1]
  dominio<-x[2]
  
 NumGenes<-(Genes$freq[which(Genes$Family==familia)]) 
#result<-NumGenes
  ## contar genes familia
 FreqDom<-DomTable$freq[which(DomTable$Family==familia & DomTable$DomainName==dominio)]
 result<-FreqDom/NumGenes
 return(result)
}

DomTable$DomFreq<-apply(DomTable,1,FrecuenciaDominioFamilia)

ggplot(DomTable, aes(x=DomTable$DomainName,y=DomTable$DomFreq,fill=DomTable$Family)) +geom_bar(stat = "identity")

## Objetivo Contar ocurrencias de dominio por familia y obtener la frecuencia de dominio por familia 
## Data frame 
# Dominio Familia OcurrenciaRelativa

```

